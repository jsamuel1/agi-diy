<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>agi.diy ‚Äî Mesh Dashboard</title>
<style>
:root {
  --bg: #0a0a0f; --bg-panel: #12121a; --bg-card: #1a1a26; --bg-hover: #22222e;
  --border: #2a2a3a; --text: #e0e0e8; --text-dim: #888898; --text-muted: #555568;
  --accent: #7c5cff; --green: #00ff88; --blue: #00aaff; --pink: #ff88ff;
  --orange: #ffaa00; --red: #ff6666; --cyan: #88ffff;
  --radius: 8px; --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --block-header: 32px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: var(--font); background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

/* ‚îÄ‚îÄ Block Layout Engine ‚îÄ‚îÄ */
.layout { display: flex; height: 100vh; width: 100vw; gap: 1px; background: var(--border); }
.layout-col { display: flex; flex-direction: column; gap: 1px; min-width: 0; }
.block { background: var(--bg-panel); display: flex; flex-direction: column; min-height: 0; overflow: hidden; position: relative; }
.block.maximized { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 100; }
.block-header { height: var(--block-header); min-height: var(--block-header); display: flex; align-items: center; padding: 0 10px; gap: 6px; background: var(--bg-card); border-bottom: 1px solid var(--border); cursor: default; user-select: none; }
.block-icon { font-size: 12px; }
.block-title { font-size: 11px; font-weight: 600; color: var(--text-dim); flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.block-btn { background: none; border: none; color: var(--text-muted); font-size: 12px; cursor: pointer; padding: 2px 4px; border-radius: 3px; line-height: 1; }
.block-btn:hover { color: var(--text); background: var(--bg-hover); }
.block-body { flex: 1; overflow-y: auto; overflow-x: hidden; }
.block-body::-webkit-scrollbar { width: 4px; }
.block-body::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* ‚îÄ‚îÄ Add Block Bar ‚îÄ‚îÄ */
.add-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 36px; background: var(--bg-card); border-top: 1px solid var(--border); display: flex; align-items: center; justify-content: center; gap: 8px; z-index: 50; }
.add-btn { background: var(--bg-hover); border: 1px solid var(--border); color: var(--text-dim); font-size: 11px; padding: 4px 12px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 4px; }
.add-btn:hover { color: var(--text); border-color: var(--accent); }
.wall-clock { font-size: 11px; color: var(--accent); font-variant-numeric: tabular-nums; position: fixed; bottom: 0; right: 12px; height: 36px; display: flex; align-items: center; z-index: 51; }

/* ‚îÄ‚îÄ Agent List ‚îÄ‚îÄ */
.agent-list { display: flex; flex-direction: column; gap: 2px; padding: 6px; }
.agent-card { display: flex; align-items: center; gap: 8px; padding: 7px 8px; border-radius: 6px; cursor: pointer; transition: background .12s; }
.agent-card:hover { background: var(--bg-hover); }
.agent-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.agent-dot.pulse { animation: pulse 2s infinite; }
@keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: .4; } }
.agent-info { flex: 1; min-width: 0; }
.agent-name { font-size: 12px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.agent-model { font-size: 10px; color: var(--text-muted); }
.agent-badge { font-size: 9px; padding: 2px 6px; border-radius: 4px; background: var(--bg); }

/* ‚îÄ‚îÄ Task Tree ‚îÄ‚îÄ */
.task-tree { display: flex; flex-direction: column; gap: 1px; padding: 6px; }
.task-item { display: flex; align-items: flex-start; gap: 6px; padding: 5px 8px; border-radius: 5px; cursor: pointer; transition: background .12s; border-left: 3px solid transparent; }
.task-item:hover { background: var(--bg-hover); }
.task-item.d1 { padding-left: 22px; } .task-item.d2 { padding-left: 38px; }
.task-status { font-size: 11px; flex-shrink: 0; margin-top: 1px; }
.task-info { flex: 1; min-width: 0; }
.task-title { font-size: 11px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.task-meta { font-size: 9px; color: var(--text-muted); display: flex; gap: 6px; margin-top: 1px; }
.task-item[data-status="complete"] .task-title { color: var(--text-muted); text-decoration: line-through; }

/* ‚îÄ‚îÄ Chat ‚îÄ‚îÄ */
.chat-wrap { display: flex; flex-direction: column; height: 100%; }
.messages { flex: 1; overflow-y: auto; padding: 12px; display: flex; flex-direction: column; gap: 10px; }
.messages::-webkit-scrollbar { width: 4px; }
.messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
.msg { max-width: 85%; padding: 8px 12px; border-radius: 10px; font-size: 12px; line-height: 1.5; }
.msg.user { align-self: flex-end; background: var(--accent); color: #fff; border-bottom-right-radius: 3px; }
.msg.assistant { align-self: flex-start; background: var(--bg-card); border-bottom-left-radius: 3px; }
.msg .msg-agent { font-size: 10px; font-weight: 600; margin-bottom: 3px; }
.msg .msg-time { font-size: 9px; color: var(--text-muted); margin-top: 3px; text-align: right; }
.input-area { padding: 8px 12px; border-top: 1px solid var(--border); display: flex; gap: 6px; }
.input-area textarea { flex: 1; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text); padding: 8px 10px; font-family: var(--font); font-size: 12px; resize: none; outline: none; min-height: 36px; max-height: 100px; }
.input-area textarea:focus { border-color: var(--accent); }
.send-btn { background: var(--accent); border: none; color: #fff; border-radius: var(--radius); padding: 0 14px; cursor: pointer; font-size: 12px; font-weight: 500; }
.send-btn:hover { opacity: .85; }

/* ‚îÄ‚îÄ Ring Buffer ‚îÄ‚îÄ */
.ring-entries { display: flex; flex-direction: column; gap: 4px; padding: 6px; }
.ring-entry { padding: 6px 8px; background: var(--bg-card); border-radius: 5px; border-left: 3px solid var(--border); }
.ring-entry .re-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 3px; }
.ring-entry .re-agent { font-size: 10px; font-weight: 600; }
.ring-entry .re-time { font-size: 9px; color: var(--text-muted); }
.ring-entry .re-text { font-size: 10px; color: var(--text-dim); line-height: 1.4; }

/* ‚îÄ‚îÄ Task Detail ‚îÄ‚îÄ */
.task-detail-view { padding: 12px; }
.td-back { background: none; border: none; color: var(--text-dim); cursor: pointer; font-size: 16px; padding: 2px 6px; }
.td-back:hover { color: var(--text); }
.td-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
.td-title { font-size: 14px; font-weight: 600; }
.td-status { font-size: 10px; padding: 2px 8px; border-radius: 4px; }
.worklog { display: flex; flex-direction: column; gap: 6px; }
.wl-entry { padding: 8px 10px; background: var(--bg-card); border-radius: 6px; border-left: 3px solid var(--border); }
.wl-entry .wl-head { display: flex; justify-content: space-between; font-size: 9px; color: var(--text-muted); margin-bottom: 3px; }
.wl-entry .wl-msg { font-size: 11px; line-height: 1.5; }

/* ‚îÄ‚îÄ Mobile ‚îÄ‚îÄ */
@media (max-width: 768px) { .layout { flex-direction: column; } }
</style>
</head>
<body>
<!-- Layout is built by JS -->
<div id="root"></div>
<div class="add-bar">
  <button class="add-btn" onclick="addBlock('chat')">+ Chat</button>
  <button class="add-btn" onclick="addBlock('agents')">+ Agents</button>
  <button class="add-btn" onclick="addBlock('tasks')">+ Tasks</button>
  <button class="add-btn" onclick="addBlock('ring')">+ Ring</button>
  <button class="add-btn" onclick="addBlock('task-detail')">+ Task Detail</button>
</div>
<div class="wall-clock" id="wallClock">‚è± 0:00</div>

<script>
if (typeof Symbol.dispose === 'undefined') Symbol.dispose = Symbol('Symbol.dispose');
if (typeof Symbol.asyncDispose === 'undefined') Symbol.asyncDispose = Symbol('Symbol.asyncDispose');
</script>
<script type="module">
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SECTION INDEX
// STATE ............. Constants, mock data, layout config
// BLOCKS ............ Block registry, renderers, layout engine
// RENDERERS ......... Per-block-type content renderers
// TASK DETAIL ....... Click-to-zoom task detail
// LAYOUT ............ Build/rebuild layout from config
// INIT .............. Startup
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê
const COLORS = ['#00ff88','#00aaff','#ff88ff','#ffaa00','#ff6666','#88ffff'];
const STATUS_ICON = { pending:'‚¨ú', 'in-progress':'üîµ', waiting:'‚è≥', complete:'üü¢', failed:'üî¥' };
const STATUS_LABEL = { pending:'Pending', 'in-progress':'In Progress', waiting:'Waiting', complete:'Complete', failed:'Failed' };
const BLOCK_META = {
  agents:       { icon:'üë•', title:'Agents' },
  tasks:        { icon:'üìã', title:'Tasks' },
  chat:         { icon:'üí¨', title:'Chat' },
  ring:         { icon:'üîµ', title:'Ring Buffer' },
  'task-detail':{ icon:'üîç', title:'Task Detail' },
  preview:      { icon:'üñºÔ∏è', title:'Preview' },
};

const state = {
  agents: new Map(),
  tasks: new Map(),
  ringBuffer: [],
  wallClockStart: null,
  layout: [
    { id:'col-left', type:'col', flex:1, children:[
      { id:'b-agents', type:'agents', flex:1 },
      { id:'b-tasks', type:'tasks', flex:2 },
    ]},
    { id:'b-chat', type:'chat', flex:2 },
    { id:'b-ring', type:'ring', flex:1 },
  ],
  blockCounter: 10,
  maximizedBlock: null,
};

// ‚îÄ‚îÄ Mock Data ‚îÄ‚îÄ
function loadMockData() {
  [
    { id:'orchestrator', model:'Claude Sonnet', status:'ready', color:COLORS[0] },
    { id:'researcher', model:'Claude Haiku', status:'processing', color:COLORS[1] },
    { id:'coder', model:'GPT-4o', status:'processing', color:COLORS[2] },
    { id:'reviewer', model:'WebLLM Qwen 3B', status:'idle', color:COLORS[3] },
  ].forEach(a => state.agents.set(a.id, a));

  [
    { id:'t1', title:'Build Space Minecraft (Browser)', status:'in-progress', agentId:'orchestrator', parentId:null, children:['t1a','t1b','t1c'], worklog:[
      { ts:Date.now()-120000, agentId:'orchestrator', msg:'Decomposed into 3 sub-tasks' },
    ]},
    { id:'t1a', title:'Voxel world generation', status:'in-progress', agentId:'coder', parentId:'t1', children:[], worklog:[
      { ts:Date.now()-90000, agentId:'coder', msg:'Implementing perlin noise terrain' },
      { ts:Date.now()-30000, agentId:'coder', msg:'Terrain gen complete, adding biomes' },
    ]},
    { id:'t1b', title:'Player movement & controls', status:'waiting', agentId:null, parentId:'t1', children:[], worklog:[] },
    { id:'t1c', title:'WebGL rendering pipeline', status:'pending', agentId:null, parentId:'t1', children:[], worklog:[] },
    { id:'t2', title:'Triage Slack messages', status:'in-progress', agentId:'researcher', parentId:null, children:[], worklog:[
      { ts:Date.now()-60000, agentId:'researcher', msg:'Scanning channels ‚Äî 47 unread' },
    ]},
    { id:'t3', title:'Draft email responses', status:'pending', agentId:null, parentId:null, children:[], worklog:[] },
    { id:'t4', title:'Fix auth bug in relay', status:'complete', agentId:'coder', parentId:null, children:[], worklog:[
      { ts:Date.now()-300000, agentId:'coder', msg:'SigV4 signing fix ‚Äî manual URI encoding' },
      { ts:Date.now()-240000, agentId:'reviewer', msg:'LGTM, tested against ap-southeast-2' },
    ]},
  ].forEach(t => state.tasks.set(t.id, t));

  state.ringBuffer = [
    { agentId:'orchestrator', content:'Decomposed "Build Space Minecraft" into 3 parallel sub-tasks', ts:Date.now()-120000 },
    { agentId:'coder', content:'Starting voxel world generation with perlin noise', ts:Date.now()-90000 },
    { agentId:'researcher', content:'Scanning Slack channels ‚Äî 47 unread messages found', ts:Date.now()-60000 },
    { agentId:'coder', content:'Terrain generation complete. Adding biome color mapping.', ts:Date.now()-30000 },
    { agentId:'orchestrator', content:'Auth bug fix verified. Moving coder to rendering next.', ts:Date.now()-10000 },
  ];
  state.wallClockStart = Date.now() - 135000;
}

// ‚ïê‚ïê‚ïê RENDERERS ‚ïê‚ïê‚ïê
function renderAgentsBlock(container) {
  container.innerHTML = '<div class="agent-list">' + [...state.agents.values()].map(a => `
    <div class="agent-card" data-agent="${a.id}">
      <div class="agent-dot ${a.status==='processing'?'pulse':''}" style="background:${a.color}"></div>
      <div class="agent-info">
        <div class="agent-name">${a.id}</div>
        <div class="agent-model">${a.model}</div>
      </div>
      <div class="agent-badge" style="color:${a.status==='processing'?a.color:'var(--text-muted)'}">${a.status}</div>
    </div>
  `).join('') + '</div>';
}

function renderTasksBlock(container) {
  const roots = [...state.tasks.values()].filter(t => !t.parentId);
  const html = [];
  function walk(task, depth) {
    const agent = task.agentId ? state.agents.get(task.agentId) : null;
    const color = agent?.color || 'var(--text-muted)';
    html.push(`<div class="task-item d${depth}" data-task="${task.id}" data-status="${task.status}" style="border-left-color:${color}">
      <span class="task-status">${STATUS_ICON[task.status]}</span>
      <div class="task-info">
        <div class="task-title">${task.title}</div>
        <div class="task-meta">
          ${task.agentId ? `<span style="color:${color}">${task.agentId}</span>` : '<span>unassigned</span>'}
          ${task.worklog.length ? `<span>${task.worklog.length} logs</span>` : ''}
        </div>
      </div>
    </div>`);
    (task.children||[]).forEach(cid => { const c = state.tasks.get(cid); if(c) walk(c, depth+1); });
  }
  roots.forEach(t => walk(t, 0));
  container.innerHTML = '<div class="task-tree">' + html.join('') + '</div>';
  container.querySelectorAll('.task-item').forEach(el => {
    el.addEventListener('click', () => openTaskDetail(el.dataset.task));
  });
}

function renderChatBlock(container) {
  if (container.querySelector('.chat-wrap')) return; // already initialized
  container.innerHTML = `<div class="chat-wrap">
    <div class="messages" id="msg-${container.closest('.block').id}">
      <div class="msg assistant">
        <div class="msg-agent" style="color:var(--green)">orchestrator</div>
        Ready. 4 agents online. Give me a goal and I'll decompose it into parallel tasks.
        <div class="msg-time">2:15 PM</div>
      </div>
      <div class="msg user">Build Space Minecraft two ways, triage Slack, draft emails, fix auth bug.<div class="msg-time">2:15 PM</div></div>
      <div class="msg assistant">
        <div class="msg-agent" style="color:var(--green)">orchestrator</div>
        Created 4 top-level tasks. Coder ‚Üí Minecraft, Researcher ‚Üí Slack. Auth bug already fixed ‚úì
        <div class="msg-time">2:16 PM</div>
      </div>
    </div>
    <div class="input-area">
      <textarea placeholder="Message the mesh‚Ä¶" rows="1"></textarea>
      <button class="send-btn">Send</button>
    </div>
  </div>`;
  const ta = container.querySelector('textarea');
  ta.addEventListener('input', () => { ta.style.height = 'auto'; ta.style.height = ta.scrollHeight + 'px'; });
  ta.addEventListener('keydown', e => { if(e.key==='Enter' && !e.shiftKey) e.preventDefault(); });
}

function renderRingBlock(container) {
  const sorted = [...state.ringBuffer].sort((a,b) => b.ts - a.ts);
  container.innerHTML = '<div class="ring-entries">' + sorted.map(e => {
    const agent = state.agents.get(e.agentId);
    const color = agent?.color || '#888';
    const time = new Date(e.ts).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'});
    return `<div class="ring-entry" style="border-left-color:${color}">
      <div class="re-header"><span class="re-agent" style="color:${color}">${e.agentId}</span><span class="re-time">${time}</span></div>
      <div class="re-text">${e.content.slice(0,200)}</div>
    </div>`;
  }).join('') + '</div>';
}

function renderTaskDetailBlock(container, blockCfg) {
  const taskId = blockCfg?.taskId;
  if (!taskId) { container.innerHTML = '<div style="padding:20px;color:var(--text-muted);font-size:12px;text-align:center">Click a task to view details</div>'; return; }
  const task = state.tasks.get(taskId);
  if (!task) { container.innerHTML = '<div style="padding:20px;color:var(--text-muted);font-size:12px">Task not found</div>'; return; }
  const agent = task.agentId ? state.agents.get(task.agentId) : null;
  const color = agent?.color || 'var(--text-muted)';
  const sc = {'pending':'var(--text-muted)','in-progress':'var(--blue)','waiting':'var(--orange)','complete':'var(--green)','failed':'var(--red)'};
  container.innerHTML = `<div class="task-detail-view">
    <div class="td-header">
      <div><div class="td-title">${task.title}</div>
        <div style="display:flex;gap:8px;margin-top:4px;align-items:center">
          <span class="td-status" style="background:${sc[task.status]}22;color:${sc[task.status]}">${STATUS_ICON[task.status]} ${STATUS_LABEL[task.status]}</span>
          ${task.agentId ? `<span style="font-size:11px;color:${color}">‚¨§ ${task.agentId}</span>` : '<span style="font-size:11px;color:var(--text-muted)">unassigned</span>'}
        </div>
      </div>
    </div>
    <div style="font-size:9px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;margin:8px 0 4px">Worklog</div>
    <div class="worklog">${task.worklog.length ? task.worklog.map(w => {
      const wa = state.agents.get(w.agentId); const wc = wa?.color || '#888';
      return `<div class="wl-entry" style="border-left-color:${wc}">
        <div class="wl-head"><span style="color:${wc}">${w.agentId}</span><span>${new Date(w.ts).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</span></div>
        <div class="wl-msg">${w.msg}</div>
      </div>`;
    }).join('') : '<div style="font-size:11px;color:var(--text-muted);padding:8px">No worklog entries</div>'}</div>
  </div>`;
}

const RENDERERS = { agents: renderAgentsBlock, tasks: renderTasksBlock, chat: renderChatBlock, ring: renderRingBlock, 'task-detail': renderTaskDetailBlock };

// ‚ïê‚ïê‚ïê BLOCKS ‚ïê‚ïê‚ïê
function makeBlockEl(cfg) {
  const meta = BLOCK_META[cfg.type] || { icon:'üì¶', title:cfg.type };
  const div = document.createElement('div');
  div.className = 'block';
  div.id = cfg.id;
  div.style.flex = cfg.flex || 1;
  div.innerHTML = `<div class="block-header">
    <span class="block-icon">${meta.icon}</span>
    <span class="block-title">${meta.title}</span>
    <button class="block-btn maximize-btn" title="Maximize">‚§¢</button>
    <button class="block-btn close-btn" title="Close">‚úï</button>
  </div><div class="block-body"></div>`;
  div.querySelector('.maximize-btn').addEventListener('click', () => toggleMaximize(cfg.id));
  div.querySelector('.close-btn').addEventListener('click', () => removeBlock(cfg.id));
  const body = div.querySelector('.block-body');
  const renderer = RENDERERS[cfg.type];
  if (renderer) renderer(body, cfg);
  return div;
}

function buildLayout() {
  const root = document.getElementById('root');
  root.innerHTML = '';
  const container = document.createElement('div');
  container.className = 'layout';
  container.style.height = 'calc(100vh - 36px)';

  for (const node of state.layout) {
    if (node.type === 'col') {
      const col = document.createElement('div');
      col.className = 'layout-col';
      col.style.flex = node.flex || 1;
      (node.children || []).forEach(child => col.appendChild(makeBlockEl(child)));
      container.appendChild(col);
    } else {
      container.appendChild(makeBlockEl(node));
    }
  }
  root.appendChild(container);
}

// ‚ïê‚ïê‚ïê BLOCK ACTIONS ‚ïê‚ïê‚ïê
function toggleMaximize(blockId) {
  const el = document.getElementById(blockId);
  if (!el) return;
  if (state.maximizedBlock === blockId) {
    el.classList.remove('maximized');
    state.maximizedBlock = null;
  } else {
    if (state.maximizedBlock) document.getElementById(state.maximizedBlock)?.classList.remove('maximized');
    el.classList.add('maximized');
    state.maximizedBlock = blockId;
  }
}

function findAndRemove(layout, blockId) {
  for (let i = 0; i < layout.length; i++) {
    if (layout[i].id === blockId) { layout.splice(i, 1); return true; }
    if (layout[i].children && findAndRemove(layout[i].children, blockId)) {
      if (layout[i].children.length === 0) layout.splice(i, 1);
      return true;
    }
  }
  return false;
}

function removeBlock(blockId) {
  findAndRemove(state.layout, blockId);
  buildLayout();
}

window.addBlock = function(type) {
  const id = `b-${type}-${state.blockCounter++}`;
  state.layout.push({ id, type, flex: 1 });
  buildLayout();
};

function openTaskDetail(taskId) {
  // Find existing task-detail block or create one
  let found = null;
  function search(nodes) { for (const n of nodes) { if (n.type === 'task-detail') { found = n; return; } if (n.children) search(n.children); } }
  search(state.layout);
  if (found) {
    found.taskId = taskId;
  } else {
    const id = `b-td-${state.blockCounter++}`;
    state.layout.push({ id, type: 'task-detail', flex: 1, taskId });
  }
  buildLayout();
}

// ‚ïê‚ïê‚ïê WALL CLOCK ‚ïê‚ïê‚ïê
function updateWallClock() {
  if (!state.wallClockStart) return;
  const s = Math.floor((Date.now() - state.wallClockStart) / 1000);
  document.getElementById('wallClock').textContent = `‚è± ${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;
}

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
loadMockData();
buildLayout();
setInterval(updateWallClock, 1000);
updateWallClock();
</script>
</body>
</html>
